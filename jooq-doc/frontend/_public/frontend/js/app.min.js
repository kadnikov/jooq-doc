"use strict";var App=angular.module("app",["ngLocale","ngCookies","ngResource","ngSanitize","pascalprecht.translate","ui.bootstrap","ui.router","ui.utils","angular-growl","angularMoment","angularUtils.directives.dirPagination","app.partials","app.common.config","app.common.directives","app.common.services","app.search.services","app.todo.controllers","app.todo.services"]);angular.module("app.common.config",[]).config(["$urlRouterProvider","$locationProvider",function($urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!1)}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/jooq/frontend/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$translateProvider.useLocalStorage(),$translateProvider.useMissingTranslationHandlerLog()}]).config(["growlProvider",function(growlProvider){growlProvider.globalTimeToLive(5e3)}]),angular.module("app.common.directives",[]).directive("staticInclude",["$http","$templateCache","$compile",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=$("<div/>").html(response).contents();element.html(contents),$compile(contents)(scope)})}}]),angular.module("app.common.services",[]).service("NotificationService",["$rootScope","growl",function($rootScope,growl){function displayNotification(message,type){"success"===type?growl.addSuccessMessage(message):"warn"===type?growl.addWarnMessage(message):"info"===type?growl.addInfoMessage(message):growl.addErrorMessage(message)}var flashMessageQueue=[];return $rootScope.$on("$stateChangeSuccess",function(){for(;flashMessageQueue.length>0;){var item=flashMessageQueue.shift();item&&displayNotification(item.message,item.type)}}),{flashMessage:function(message,type){flashMessageQueue.push({message:message,type:type||"info"})}}}]),angular.module("app.search.services",["ngResource"]).factory("Search",["$resource",function($resource){var api=$resource("/api/todo/search",{},{query:{method:"GET",isArray:!1}});return{findBySearchTerm:function(searchTerm,pageNumber,pageSize){return api.query({page:pageNumber,searchTerm:searchTerm,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.todo.controllers",[]).constant("paginationConfig",{pageSize:5}).config(["$stateProvider",function($stateProvider){$stateProvider.state("todo",{url:"/","abstract":!0,template:"<ui-view/>"}).state("todo.index",{url:"",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{todos:["Todos",function(Todos){return Todos.query()}]}}).state("todo.add",{url:"todo/add",controller:"AddTodoController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("todo.edit",{url:"todo/:todoId/edit",controller:"EditTodoController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.search",{url:"todo/search/:searchTerm/page/:pageNumber/size/:pageSize",controller:"SearchResultController",templateUrl:"frontend/partials/search/search-results.html",resolve:{searchTerm:["$stateParams",function($stateParams){return $stateParams.searchTerm}],searchResults:["Search","$stateParams",function(Search,$stateParams){return $stateParams.searchTerm?Search.findBySearchTerm($stateParams.searchTerm,$stateParams.pageNumber-1,$stateParams.pageSize):null}]}}).state("todo.view",{url:"todo/:todoId",controller:"ViewTodoController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}})}]).controller("TodoListController",["$scope","$state","todos",function($scope,$state,todos){console.log("Rendering todo entry list page."),$scope.todos=todos,$scope.addTodo=function(){$state.go("todo.add")}}]).controller("AddTodoController",["$scope","$state","Todos",function($scope,$state,Todos){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("todo.view",{todoId:added.id},{reload:!0,inherit:!0,notify:!0})};Todos.save($scope.todo,onSuccess)}}}]).controller("DeleteTodoController",["$scope","$modalInstance","$state","Todos","deletedTodo",function($scope,$modalInstance,$state,Todos,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("todo.index",{},{reload:!0,inherit:!0,notify:!0})};Todos.delete($scope.todo,onSuccess)}}]).controller("EditTodoController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};Todos.update($scope.todo,onSuccess)}}}]).controller("SearchController",["$scope","$state","paginationConfig",function($scope,$state,paginationConfig){var userWritingSearchTerm=!1,minimumSearchTermLength=3;$scope.missingChars=minimumSearchTermLength,$scope.searchTerm="",$scope.searchFieldBlur=function(){userWritingSearchTerm=!1},$scope.searchFieldFocus=function(){userWritingSearchTerm=!0},$scope.showMissingCharacterText=function(){return userWritingSearchTerm&&$scope.searchTerm.length<minimumSearchTermLength?!0:!1},$scope.search=function(){$scope.searchTerm.length<minimumSearchTermLength?$scope.missingChars=minimumSearchTermLength-$scope.searchTerm.length:($scope.missingChars=0,$state.go("todo.search",{searchTerm:$scope.searchTerm,pageNumber:1,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0}))}}]).controller("SearchResultController",["$scope","$state","paginationConfig","searchTerm","searchResults",function($scope,$state,paginationConfig,searchTerm,searchResults){console.log("Rendering search results page."),$scope.todos=searchResults.content,$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.pageChanged=function(newPageNumber){$state.go("todo.search",{searchTerm:searchTerm,pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("ViewTodoController",["$scope","$state","$modal","viewedTodo",function($scope,$state,$modal,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("todo.edit",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showDeleteDialog=function(){$modal.open({templateUrl:"frontend/partials/todo/delete-todo-modal.html",controller:"DeleteTodoController",resolve:{deletedTodo:function(){return $scope.todo}}})}}]),angular.module("app.todo.services",["ngResource"]).factory("Todos",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/todo/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(){return api.query()},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]),angular.module("demo",["blueimp.fileupload"]).config(["$httpProvider","fileUploadProvider",function($httpProvider,fileUploadProvider){delete $httpProvider.defaults.headers.common["X-Requested-With"],fileUploadProvider.defaults.redirect=window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s")}]).controller("DemoFileUploadController",["$scope","$http","$filter","$window",function($scope){$scope.options={url:url}}]).controller("FileDestroyController",["$scope","$http",function($scope,$http){var state,file=$scope.file;file.url?(file.$state=function(){return state},file.$destroy=function(){return state="pending",$http({url:file.deleteUrl,method:file.deleteType}).then(function(){state="resolved",$scope.clear(file)},function(){state="rejected"})}):file.$cancel||file._index||(file.$cancel=function(){$scope.clear(file)})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZHVsZS9jb21tb24vY29tbW9uLmNvbmZpZy5qcyIsIm1vZHVsZS9jb21tb24vY29tbW9uLmRpcmVjdGl2ZXMuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5zZXJ2aWNlcy5qcyIsIm1vZHVsZS9zZWFyY2gvc2VhcmNoLnNlcnZpY2VzLmpzIiwibW9kdWxlL3RvZG8vdG9kby5jb250cm9sbGVycy5qcyIsIm1vZHVsZS90b2RvL3RvZG8uc2VydmljZXMuanMiLCJtb2R1bGUvdG9kby90b2RvLnVwbG9hZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUVBLElBQUEsS0FBQSxRQUFBLE9BQUEsT0FDQSxXQUNBLFlBQ0EsYUFDQSxhQUNBLHlCQUNBLGVBQ0EsWUFDQSxXQUNBLGdCQUNBLGdCQUNBLHdDQUdBLGVBR0Esb0JBQUEsd0JBQUEsc0JBR0Esc0JBR0EsdUJBQUEscUJDdkJBLFNBQUEsT0FBQSx3QkFDQSxRQUFBLHFCQUFBLG9CQUNBLFNBQUEsbUJBQUEsbUJBQ0EsbUJBQUEsVUFBQSxLQUdBLGtCQUFBLFdBQUEsTUFHQSxRQUFBLHFCQUFBLFNBQUEsb0JBRUEsbUJBQUEsc0JBQ0EsT0FBQSx1QkFDQSxPQUFBLFVBR0EsbUJBQUEsa0JBQUEsTUFDQSxtQkFBQSxrQkFDQSxtQkFBQSxxQ0FFQSxRQUFBLGdCQUFBLFNBQUEsZUFDQSxjQUFBLGlCQUFBLFFDckJBLFFBQUEsT0FBQSw0QkFDQSxVQUFBLGlCQUFBLFFBQUEsaUJBQUEsV0FBQSxTQUFBLE1BQUEsZUFBQSxVQUNBLE1BQUEsVUFBQSxNQUFBLFFBQUEsT0FDQSxHQUFBLGNBQUEsTUFBQSxhQUVBLE9BQUEsSUFBQSxjQUFBLE1BQUEsaUJBQUEsUUFBQSxTQUFBLFVBQ0EsR0FBQSxVQUFBLEVBQUEsVUFBQSxLQUFBLFVBQUEsVUFDQSxTQUFBLEtBQUEsVUFDQSxTQUFBLFVBQUEsYUNSQSxRQUFBLE9BQUEsMEJBQ0EsUUFBQSx1QkFBQSxhQUFBLFFBQUEsU0FBQSxXQUFBLE9BR0EsUUFBQSxxQkFBQSxRQUFBLE1BQ0EsWUFBQSxLQUNBLE1BQUEsa0JBQUEsU0FDQSxTQUFBLEtBQ0EsTUFBQSxlQUFBLFNBQ0EsU0FBQSxLQUNBLE1BQUEsZUFBQSxTQUVBLE1BQUEsZ0JBQUEsU0FWQSxHQUFBLHFCQXlCQSxPQVZBLFlBQUEsSUFBQSxzQkFBQSxXQUNBLEtBQUEsa0JBQUEsT0FBQSxHQUFBLENBQ0EsR0FBQSxNQUFBLGtCQUFBLE9BQ0EsT0FDQSxvQkFBQSxLQUFBLFFBQUEsS0FBQSxVQU9BLGFBQUEsU0FBQSxRQUFBLE1BQ0Esa0JBQUEsTUFBQSxRQUFBLFFBQUEsS0FBQSxNQUFBLGNDN0JBLFFBQUEsT0FBQSx1QkFBQSxlQUNBLFFBQUEsVUFBQSxZQUFBLFNBQUEsV0FDQSxHQUFBLEtBQUEsVUFBQSx1QkFDQSxPQUFBLE9BQUEsTUFBQSxTQUFBLElBR0EsUUFDQSxpQkFBQSxTQUFBLFdBQUEsV0FBQSxVQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsV0FBQSxXQUFBLFdBQUEsS0FBQSxTQUFBLEtBQUEsWUFBQSxjQ1JBLFFBQUEsT0FBQSwyQkFDQSxTQUFBLG9CQUNBLFNBQUEsSUFHQSxRQUFBLGlCQUNBLFNBQUEsZ0JBQ0EsZUFDQSxNQUFBLFFBQ0EsSUFBQSxJQUNBLFlBQUEsRUFDQSxTQUFBLGVBRUEsTUFBQSxjQUNBLElBQUEsR0FDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxPQUFBLFFBQUEsU0FBQSxPQUNBLE1BQUEsT0FBQSxhQUlBLE1BQUEsWUFDQSxJQUFBLFdBQ0EsV0FBQSxvQkFDQSxZQUFBLHlDQUVBLE1BQUEsYUFDQSxJQUFBLG9CQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGFBQUEsUUFBQSxlQUFBLFNBQUEsTUFBQSxjQUNBLE1BQUEsY0FBQSxPQUNBLE1BQUEsSUFBQSxhQUFBLFFBRUEsVUFJQSxNQUFBLGVBQ0EsSUFBQSwwREFDQSxXQUFBLHlCQUNBLFlBQUEsK0NBQ0EsU0FDQSxZQUFBLGVBQUEsU0FBQSxjQUNBLE1BQUEsY0FBQSxhQUVBLGVBQUEsU0FBQSxlQUFBLFNBQUEsT0FBQSxjQUNBLE1BQUEsY0FBQSxXQUNBLE9BQUEsaUJBQUEsYUFBQSxXQUFBLGFBQUEsV0FBQSxFQUFBLGFBQUEsVUFHQSxVQUlBLE1BQUEsYUFDQSxJQUFBLGVBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsWUFBQSxRQUFBLGVBQUEsU0FBQSxNQUFBLGNBQ0EsTUFBQSxjQUFBLE9BQ0EsTUFBQSxJQUFBLGFBQUEsUUFFQSxhQU1BLFdBQUEsc0JBQUEsU0FBQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsT0FDQSxRQUFBLElBQUEsbUNBQ0EsT0FBQSxNQUFBLE1BRUEsT0FBQSxRQUFBLFdBQ0EsT0FBQSxHQUFBLGdCQUdBLFdBQUEscUJBQUEsU0FBQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsT0FDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxRQUVBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxPQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsTUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUdBLE9BQUEsS0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSx3QkFBQSxTQUFBLGlCQUFBLFNBQUEsUUFBQSxjQUNBLFNBQUEsT0FBQSxlQUFBLE9BQUEsTUFBQSxhQUNBLE9BQUEsS0FBQSxZQUVBLE9BQUEsT0FBQSxXQUNBLGVBQUEsUUFBQSxXQUdBLE9BQUEsT0FBQSxXQUNBLEdBQUEsV0FBQSxXQUNBLGVBQUEsUUFDQSxPQUFBLEdBQUEsaUJBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsT0FBQSxPQUFBLE9BQUEsS0FBQSxlQUdBLFdBQUEsc0JBQUEsU0FBQSxTQUFBLGNBQUEsUUFDQSxTQUFBLE9BQUEsT0FBQSxZQUFBLE9BQ0EsUUFBQSxJQUFBLGFBQ0EsT0FBQSxLQUFBLFlBRUEsT0FBQSxTQUFBLFdBQ0EsR0FBQSxPQUFBLFNBQUEsT0FBQSxDQUNBLEdBQUEsV0FBQSxTQUFBLFNBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxRQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsT0FBQSxPQUFBLE9BQUEsS0FBQSxnQkFJQSxXQUFBLG9CQUFBLFNBQUEsU0FBQSxtQkFDQSxTQUFBLE9BQUEsT0FBQSxrQkFFQSxHQUFBLHdCQUFBLEVBQ0Esd0JBQUEsQ0FFQSxRQUFBLGFBQUEsd0JBQ0EsT0FBQSxXQUFBLEdBRUEsT0FBQSxnQkFBQSxXQUNBLHVCQUFBLEdBR0EsT0FBQSxpQkFBQSxXQUNBLHVCQUFBLEdBR0EsT0FBQSx5QkFBQSxXQUNBLE1BQUEsd0JBQ0EsT0FBQSxXQUFBLE9BQUEseUJBQ0EsR0FJQSxHQUdBLE9BQUEsT0FBQSxXQUNBLE9BQUEsV0FBQSxPQUFBLHdCQUNBLE9BQUEsYUFBQSx3QkFBQSxPQUFBLFdBQUEsUUFHQSxPQUFBLGFBQUEsRUFDQSxPQUFBLEdBQUEsZUFDQSxXQUFBLE9BQUEsV0FBQSxXQUFBLEVBQUEsU0FBQSxpQkFBQSxXQUNBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxTQU1BLFdBQUEsMEJBQUEsU0FBQSxTQUFBLG1CQUFBLGFBQUEsZ0JBQ0EsU0FBQSxPQUFBLE9BQUEsaUJBQUEsV0FBQSxlQUNBLFFBQUEsSUFBQSxrQ0FDQSxPQUFBLE1BQUEsY0FBQSxRQUVBLE9BQUEsWUFDQSxZQUFBLGNBQUEsT0FBQSxFQUNBLGFBQUEsaUJBQUEsU0FDQSxXQUFBLGNBQUEsZUFHQSxPQUFBLFlBQUEsU0FBQSxlQUNBLE9BQUEsR0FBQSxlQUNBLFdBQUEsV0FBQSxXQUFBLGNBQUEsU0FBQSxpQkFBQSxXQUNBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxRQUlBLFdBQUEsc0JBQUEsU0FBQSxTQUFBLFNBQUEsYUFDQSxTQUFBLE9BQUEsT0FBQSxPQUFBLFlBQ0EsUUFBQSxJQUFBLG1DQUNBLE9BQUEsS0FBQSxXQUVBLE9BQUEsYUFBQSxXQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsT0FBQSxLQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEtBR0EsT0FBQSxpQkFBQSxXQUNBLE9BQUEsTUFDQSxZQUFBLGdEQUNBLFdBQUEsdUJBQ0EsU0FDQSxZQUFBLFdBQ0EsTUFBQSxRQUFBLGFDek1BLFFBQUEsT0FBQSxxQkFBQSxlQUNBLFFBQUEsU0FBQSxZQUFBLHNCQUFBLFNBQUEsVUFBQSxxQkFDQSxHQUFBLEtBQUEsVUFBQSxpQkFBQSxHQUFBLFFBQ0EsT0FBQSxPQUFBLE1BQUEsVUFBQSxTQUFBLEdBQ0EsS0FBQSxPQUFBLE9BQ0EsTUFBQSxPQUFBLFFBQ0EsUUFBQSxPQUFBLFFBR0EsUUFDQSxTQUFBLFNBQUEsS0FBQSxpQkFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLFdBQ0Esb0JBQUEsYUFBQSxvQ0FBQSxXQUNBLHFCQUdBLE1BQUEsV0FDQSxNQUFBLEtBQUEsU0FFQSxJQUFBLFNBQUEsUUFDQSxNQUFBLEtBQUEsS0FBQSxHQUFBLFNBQUEsVUFFQSxLQUFBLFNBQUEsS0FBQSxpQkFDQSxJQUFBLEtBQUEsS0FBQSxTQUFBLE9BQ0Esb0JBQUEsYUFBQSxpQ0FBQSxXQUNBLGdCQUFBLFVBR0EsT0FBQSxTQUFBLEtBQUEsaUJBQ0EsSUFBQSxPQUFBLEtBQUEsU0FBQSxTQUNBLG9CQUFBLGFBQUEsb0NBQUEsV0FDQSxnQkFBQSxnQkMvQkEsUUFBQSxPQUFBLFFBQ0EsdUJBRUEsUUFDQSxnQkFBQSxxQkFDQSxTQUFBLGNBQUEsMEJBQ0EsZUFBQSxTQUFBLFFBQUEsT0FBQSxvQkFDQSxtQkFBQSxTQUFBLFNBQUEsT0FBQSxTQUFBLEtBQUEsUUFDQSxZQUNBLDJCQUtBLFdBQUEsNEJBQ0EsU0FBQSxRQUFBLFVBQUEsVUFDQSxTQUFBLFFBQ0EsT0FBQSxTQUNBLElBQUEsUUFLQSxXQUFBLHlCQUNBLFNBQUEsUUFDQSxTQUFBLE9BQUEsT0FDQSxHQUNBLE9BREEsS0FBQSxPQUFBLElBRUEsTUFBQSxLQUNBLEtBQUEsT0FBQSxXQUNBLE1BQUEsUUFFQSxLQUFBLFNBQUEsV0FFQSxNQURBLE9BQUEsVUFDQSxPQUNBLElBQUEsS0FBQSxVQUNBLE9BQUEsS0FBQSxhQUNBLEtBQ0EsV0FDQSxNQUFBLFdBQ0EsT0FBQSxNQUFBLE9BRUEsV0FDQSxNQUFBLGVBSUEsS0FBQSxTQUFBLEtBQUEsU0FDQSxLQUFBLFFBQUEsV0FDQSxPQUFBLE1BQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIEFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICAgJ25nTG9jYWxlJyxcbiAgICAnbmdDb29raWVzJyxcbiAgICAnbmdSZXNvdXJjZScsXG4gICAgJ25nU2FuaXRpemUnLFxuICAgICdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJyxcbiAgICAndWkuYm9vdHN0cmFwJyxcbiAgICAndWkucm91dGVyJyxcbiAgICAndWkudXRpbHMnLFxuICAgICdhbmd1bGFyLWdyb3dsJyxcbiAgICAnYW5ndWxhck1vbWVudCcsXG4gICAgJ2FuZ3VsYXJVdGlscy5kaXJlY3RpdmVzLmRpclBhZ2luYXRpb24nLFxuXG4gICAgLy9QYXJ0aWFsc1xuICAgICdhcHAucGFydGlhbHMnLFxuXG4gICAgLy9Db21tb25cbiAgICAnYXBwLmNvbW1vbi5jb25maWcnLCAnYXBwLmNvbW1vbi5kaXJlY3RpdmVzJywgJ2FwcC5jb21tb24uc2VydmljZXMnLFxuXG4gICAgLy9TZWFyY2hcbiAgICAnYXBwLnNlYXJjaC5zZXJ2aWNlcycsXG5cbiAgICAvL1RvZG9cbiAgICAnYXBwLnRvZG8uY29udHJvbGxlcnMnLCAnYXBwLnRvZG8uc2VydmljZXMnXG5cbl0pO1xuXG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuY29tbW9uLmNvbmZpZycsIFtdKVxuICAgIC5jb25maWcoWyckdXJsUm91dGVyUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG4gICAgICAgICAgICAvLyBXaXRob3V0IHNlcnZlciBzaWRlIHN1cHBvcnQgaHRtbDUgbXVzdCBiZSBkaXNhYmxlZC5cbiAgICAgICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5jb25maWcoWyckdHJhbnNsYXRlUHJvdmlkZXInLCBmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIEluaXRpYWxpemUgYW5ndWxhci10cmFuc2xhdGVcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVN0YXRpY0ZpbGVzTG9hZGVyKHtcbiAgICAgICAgICAgIHByZWZpeDogJy9qb29xL2Zyb250ZW5kL2kxOG4vJyxcbiAgICAgICAgICAgIHN1ZmZpeDogJy5qc29uJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXIucHJlZmVycmVkTGFuZ3VhZ2UoJ2VuJyk7XG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJMb2coKTtcbiAgICB9XSlcbiAgICAuY29uZmlnKFsnZ3Jvd2xQcm92aWRlcicsIGZ1bmN0aW9uIChncm93bFByb3ZpZGVyKSB7XG4gICAgICAgIGdyb3dsUHJvdmlkZXIuZ2xvYmFsVGltZVRvTGl2ZSg1MDAwKTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5kaXJlY3RpdmVzJywgW10pXG4gICAgLmRpcmVjdGl2ZSgnc3RhdGljSW5jbHVkZScsIFsnJGh0dHAnLCAnJHRlbXBsYXRlQ2FjaGUnLCAnJGNvbXBpbGUnLCBmdW5jdGlvbiAoJGh0dHAsICR0ZW1wbGF0ZUNhY2hlLCAkY29tcGlsZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgdGVtcGxhdGVQYXRoID0gYXR0cnMuc3RhdGljSW5jbHVkZTtcblxuICAgICAgICAgICAgJGh0dHAuZ2V0KHRlbXBsYXRlUGF0aCwge2NhY2hlOiAkdGVtcGxhdGVDYWNoZX0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gJCgnPGRpdi8+JykuaHRtbChyZXNwb25zZSkuY29udGVudHMoKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoY29udGVudHMpO1xuICAgICAgICAgICAgICAgICRjb21waWxlKGNvbnRlbnRzKShzY29wZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5zZXJ2aWNlcycsIFtdKVxuICAgIC5zZXJ2aWNlKCdOb3RpZmljYXRpb25TZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgJ2dyb3dsJywgZnVuY3Rpb24gKCRyb290U2NvcGUsIGdyb3dsKSB7XG4gICAgICAgIHZhciBmbGFzaE1lc3NhZ2VRdWV1ZSA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb24obWVzc2FnZSwgdHlwZSkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZFN1Y2Nlc3NNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2FybicpIHtcbiAgICAgICAgICAgICAgICBncm93bC5hZGRXYXJuTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2luZm8nKSB7XG4gICAgICAgICAgICAgICAgZ3Jvd2wuYWRkSW5mb01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZEVycm9yTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERpc3BsYXkgYWxsIGZsYXNoIG5vdGlmaWNhdGlvbnMgYWZ0ZXIgc3RhdGUgaGFzIGNoYW5nZWRcbiAgICAgICAgJHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdWNjZXNzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHdoaWxlIChmbGFzaE1lc3NhZ2VRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBmbGFzaE1lc3NhZ2VRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb3RpZmljYXRpb24oaXRlbS5tZXNzYWdlLCBpdGVtLnR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUHVibGljIEFQSVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2ZsYXNoTWVzc2FnZSc6IGZ1bmN0aW9uIChtZXNzYWdlLCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgZmxhc2hNZXNzYWdlUXVldWUucHVzaCh7bWVzc2FnZTogbWVzc2FnZSwgdHlwZTogdHlwZSB8fCAnaW5mbyd9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuc2VhcmNoLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1NlYXJjaCcsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgICAgIHZhciBhcGkgPSAkcmVzb3VyY2UoJy9hcGkvdG9kby9zZWFyY2gnLCB7fSwge1xuICAgICAgICAgICAgJ3F1ZXJ5JzogIHttZXRob2Q6J0dFVCcsIGlzQXJyYXk6ZmFsc2V9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaW5kQnlTZWFyY2hUZXJtOiBmdW5jdGlvbihzZWFyY2hUZXJtLCBwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkucXVlcnkoe3BhZ2U6IHBhZ2VOdW1iZXIsIHNlYXJjaFRlcm06IHNlYXJjaFRlcm0sIHNpemU6IHBhZ2VTaXplLCBzb3J0OiAnSUQsREVTQyd9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLnRvZG8uY29udHJvbGxlcnMnLCBbXSlcbiAgICAuY29uc3RhbnQoJ3BhZ2luYXRpb25Db25maWcnLCB7XG4gICAgICAgIHBhZ2VTaXplOiA1XG4gICAgfSlcbiAgICBcbiAgICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPHVpLXZpZXcvPidcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uaW5kZXgnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJycsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb2RvTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdG9kby1saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2RvczogWydUb2RvcycsIGZ1bmN0aW9uKFRvZG9zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLnF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uYWRkJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvL2FkZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBZGRUb2RvQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9hZGQtdG9kby5odG1sJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmVkaXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vOnRvZG9JZC9lZGl0JyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0VkaXRUb2RvQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9lZGl0LXRvZG8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRUb2RvOiBbJ1RvZG9zJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFRvZG9zLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnRvZG9JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9kb3MuZ2V0KCRzdGF0ZVBhcmFtcy50b2RvSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kby5zZWFyY2gnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vc2VhcmNoLzpzZWFyY2hUZXJtL3BhZ2UvOnBhZ2VOdW1iZXIvc2l6ZS86cGFnZVNpemUnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU2VhcmNoUmVzdWx0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvc2VhcmNoL3NlYXJjaC1yZXN1bHRzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hUZXJtOiBbJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKCRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdGVQYXJhbXMuc2VhcmNoVGVybTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0czogWydTZWFyY2gnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oU2VhcmNoLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnNlYXJjaFRlcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNlYXJjaC5maW5kQnlTZWFyY2hUZXJtKCRzdGF0ZVBhcmFtcy5zZWFyY2hUZXJtLCAkc3RhdGVQYXJhbXMucGFnZU51bWJlciAtIDEsICRzdGF0ZVBhcmFtcy5wYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8udmlldycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby86dG9kb0lkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1ZpZXdUb2RvQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby92aWV3LXRvZG8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdlZFRvZG86IFsnVG9kb3MnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oVG9kb3MsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMudG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUb2Rvcy5nZXQoJHN0YXRlUGFyYW1zLnRvZG9JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgXSlcbiAgICAuY29udHJvbGxlcignVG9kb0xpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3RvZG9zJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJHN0YXRlLCB0b2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyB0b2RvIGVudHJ5IGxpc3QgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHRvZG9zO1xuXG4gICAgICAgICAgICAkc2NvcGUuYWRkVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby5hZGQnKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdBZGRUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBUb2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBhZGQgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB7fTtcblxuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IGFkZGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBUb2Rvcy5zYXZlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdEZWxldGVUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRtb2RhbEluc3RhbmNlJywgJyRzdGF0ZScsICdUb2RvcycsICdkZWxldGVkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgVG9kb3MsIGRlbGV0ZWRUb2RvKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IGRlbGV0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8uaW5kZXgnLCB7fSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFRvZG9zLmRlbGV0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdFZGl0VG9kb0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAndXBkYXRlZFRvZG8nLCAnVG9kb3MnLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgdXBkYXRlZFRvZG8sIFRvZG9zKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh1cGRhdGVkVG9kbyk7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IHVwZGF0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZVRvZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnRvZG9Gb3JtLiR2YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnZpZXcnLCB7dG9kb0lkOiB1cGRhdGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgVG9kb3MudXBkYXRlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLFxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcpIHtcblxuICAgICAgICAgICAgdmFyIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoID0gMztcblxuICAgICAgICAgICAgJHNjb3BlLm1pc3NpbmdDaGFycyA9IG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoO1xuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaFRlcm0gPSBcIlwiO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXNlcldyaXRpbmdTZWFyY2hUZXJtID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRGb2N1cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd01pc3NpbmdDaGFyYWN0ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJXcml0aW5nU2VhcmNoVGVybSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaFRlcm0ubGVuZ3RoIDwgbWluaW11bVNlYXJjaFRlcm1MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGggPCBtaW5pbXVtU2VhcmNoVGVybUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gbWluaW11bVNlYXJjaFRlcm1MZW5ndGggLSAkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB7c2VhcmNoVGVybTogJHNjb3BlLnNlYXJjaFRlcm0sIHBhZ2VOdW1iZXI6IDEsIHBhZ2VTaXplOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hSZXN1bHRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLCAnc2VhcmNoVGVybScsICdzZWFyY2hSZXN1bHRzJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcsIHNlYXJjaFRlcm0sIHNlYXJjaFJlc3VsdHMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgc2VhcmNoIHJlc3VsdHMgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHNlYXJjaFJlc3VsdHMuY29udGVudDtcblxuICAgICAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IHNlYXJjaFJlc3VsdHMubnVtYmVyICsgMSxcbiAgICAgICAgICAgICAgICBpdGVtc1BlclBhZ2U6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemUsXG4gICAgICAgICAgICAgICAgdG90YWxJdGVtczogc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUucGFnZUNoYW5nZWQgPSBmdW5jdGlvbihuZXdQYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBwYWdlTnVtYmVyOiBuZXdQYWdlTnVtYmVyLCBwYWdlU2l6ZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZX0sXG4gICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ1ZpZXdUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICckbW9kYWwnLCAndmlld2VkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkbW9kYWwsIHZpZXdlZFRvZG8pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgdmlldyB0b2RvIGVudHJ5IHBhZ2UuJyk7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IHZpZXdlZFRvZG87XG5cbiAgICAgICAgICAgICRzY29wZS5zaG93RWRpdFBhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oXCJ0b2RvLmVkaXRcIiwge3RvZG9JZDogJHNjb3BlLnRvZG8uaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNob3dEZWxldGVEaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9kZWxldGUtdG9kby1tb2RhbC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0RlbGV0ZVRvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFRvZG86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnRvZG87XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC50b2RvLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1RvZG9zJywgWyckcmVzb3VyY2UnLCAnTm90aWZpY2F0aW9uU2VydmljZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSwgTm90aWZpY2F0aW9uU2VydmljZSkge1xuICAgICAgICB2YXIgYXBpID0gJHJlc291cmNlKCcvYXBpL3RvZG8vOmlkJywge1wiaWRcIjogXCJAaWRcIn0sIHtcbiAgICAgICAgICAgIHF1ZXJ5OiAge21ldGhvZDogJ0dFVCcsIHBhcmFtczoge30sIGlzQXJyYXk6IHRydWV9LFxuICAgICAgICAgICAgZ2V0OiAgICB7bWV0aG9kOiAnR0VUJ30sXG4gICAgICAgICAgICBzYXZlOiB7bWV0aG9kOiAnUE9TVCd9LFxuICAgICAgICAgICAgdXBkYXRlOiB7bWV0aG9kOiAnUFVUJ31cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRlbGV0ZTogZnVuY3Rpb24odG9kbywgc3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5kZWxldGUodG9kbywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblNlcnZpY2UuZmxhc2hNZXNzYWdlKCd0b2RvLm5vdGlmaWNhdGlvbnMuZGVsZXRlLnN1Y2Nlc3MnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBxdWVyeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5xdWVyeSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24odG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQoe2lkOiB0b2RvSWR9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlOiBmdW5jdGlvbih0b2RvLCBzdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBhcGkuc2F2ZSh0b2RvLCBmdW5jdGlvbihhZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmFkZC5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGFkZGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUodG9kbywgZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLnVwZGF0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnZGVtbycsIFtcclxuICAgICdibHVlaW1wLmZpbGV1cGxvYWQnXHJcbl0pXHJcbiAgICAuY29uZmlnKFtcclxuICAgICAgICAnJGh0dHBQcm92aWRlcicsICdmaWxlVXBsb2FkUHJvdmlkZXInLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyLCBmaWxlVXBsb2FkUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgZGVsZXRlICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtUmVxdWVzdGVkLVdpdGgnXTtcclxuICAgICAgICAgICAgZmlsZVVwbG9hZFByb3ZpZGVyLmRlZmF1bHRzLnJlZGlyZWN0ID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZShcclxuICAgICAgICAgICAgICAgIC9cXC9bXlxcL10qJC8sXHJcbiAgICAgICAgICAgICAgICAnL2NvcnMvcmVzdWx0Lmh0bWw/JXMnXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgXSlcclxuXHJcbiAgICAuY29udHJvbGxlcignRGVtb0ZpbGVVcGxvYWRDb250cm9sbGVyJywgW1xyXG4gICAgICAgICckc2NvcGUnLCAnJGh0dHAnLCAnJGZpbHRlcicsICckd2luZG93JyxcclxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCkge1xyXG4gICAgICAgICAgICAkc2NvcGUub3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHVybDogdXJsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgXSlcclxuXHJcbiAgICAuY29udHJvbGxlcignRmlsZURlc3Ryb3lDb250cm9sbGVyJywgW1xyXG4gICAgICAgICckc2NvcGUnLCAnJGh0dHAnLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWxlID0gJHNjb3BlLmZpbGUsXHJcbiAgICAgICAgICAgICAgICBzdGF0ZTtcclxuICAgICAgICAgICAgaWYgKGZpbGUudXJsKSB7XHJcbiAgICAgICAgICAgICAgICBmaWxlLiRzdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZmlsZS4kZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9ICdwZW5kaW5nJztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGZpbGUuZGVsZXRlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IGZpbGUuZGVsZXRlVHlwZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gJ3Jlc29sdmVkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jbGVhcihmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAncmVqZWN0ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZpbGUuJGNhbmNlbCAmJiAhZmlsZS5faW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGZpbGUuJGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xlYXIoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==