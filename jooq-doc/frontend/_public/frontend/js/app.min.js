"use strict";var App=angular.module("app",["ngLocale","ngCookies","ngResource","ngSanitize","pascalprecht.translate","ui.bootstrap","ui.router","ui.utils","angular-growl","angularMoment","angularUtils.directives.dirPagination","app.partials","app.common.config","app.common.directives","app.common.services","app.search.services","app.todo.controllers","app.todo.services"]);angular.module("app.common.config",[]).config(["$urlRouterProvider","$locationProvider",function($urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!1)}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/frontend/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$translateProvider.useLocalStorage(),$translateProvider.useMissingTranslationHandlerLog()}]).config(["growlProvider",function(growlProvider){growlProvider.globalTimeToLive(5e3)}]),angular.module("app.common.directives",[]).directive("staticInclude",["$http","$templateCache","$compile",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=$("<div/>").html(response).contents();element.html(contents),$compile(contents)(scope)})}}]),angular.module("app.common.services",[]).service("NotificationService",["$rootScope","growl",function($rootScope,growl){function displayNotification(message,type){"success"===type?growl.addSuccessMessage(message):"warn"===type?growl.addWarnMessage(message):"info"===type?growl.addInfoMessage(message):growl.addErrorMessage(message)}var flashMessageQueue=[];return $rootScope.$on("$stateChangeSuccess",function(){for(;flashMessageQueue.length>0;){var item=flashMessageQueue.shift();item&&displayNotification(item.message,item.type)}}),{flashMessage:function(message,type){flashMessageQueue.push({message:message,type:type||"info"})}}}]),angular.module("app.search.services",["ngResource"]).factory("Search",["$resource",function($resource){var api=$resource("/api/todo/search",{},{query:{method:"GET",isArray:!1}});return{findBySearchTerm:function(searchTerm,pageNumber,pageSize){return api.query({page:pageNumber,searchTerm:searchTerm,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.todo.controllers",[]).constant("paginationConfig",{pageSize:5}).config(["$stateProvider",function($stateProvider){$stateProvider.state("todo",{url:"/","abstract":!0,template:"<ui-view/>"}).state("todo.index",{url:"",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{todos:["Todos",function(Todos){return Todos.query()}]}}).state("todo.add",{url:"todo/add",controller:"AddTodoController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("todo.edit",{url:"todo/:todoId/edit",controller:"EditTodoController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.search",{url:"todo/search/:searchTerm/page/:pageNumber/size/:pageSize",controller:"SearchResultController",templateUrl:"frontend/partials/search/search-results.html",resolve:{searchTerm:["$stateParams",function($stateParams){return $stateParams.searchTerm}],searchResults:["Search","$stateParams",function(Search,$stateParams){return $stateParams.searchTerm?Search.findBySearchTerm($stateParams.searchTerm,$stateParams.pageNumber-1,$stateParams.pageSize):null}]}}).state("todo.view",{url:"todo/:todoId",controller:"ViewTodoController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}})}]).controller("TodoListController",["$scope","$state","todos",function($scope,$state,todos){console.log("Rendering todo entry list page."),$scope.todos=todos,$scope.addTodo=function(){$state.go("todo.add")}}]).controller("AddTodoController",["$scope","$state","Todos",function($scope,$state,Todos){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("todo.view",{todoId:added.id},{reload:!0,inherit:!0,notify:!0})};Todos.save($scope.todo,onSuccess)}}}]).controller("DeleteTodoController",["$scope","$modalInstance","$state","Todos","deletedTodo",function($scope,$modalInstance,$state,Todos,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("todo.index",{},{reload:!0,inherit:!0,notify:!0})};Todos.delete($scope.todo,onSuccess)}}]).controller("EditTodoController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};Todos.update($scope.todo,onSuccess)}}}]).controller("SearchController",["$scope","$state","paginationConfig",function($scope,$state,paginationConfig){var userWritingSearchTerm=!1,minimumSearchTermLength=3;$scope.missingChars=minimumSearchTermLength,$scope.searchTerm="",$scope.searchFieldBlur=function(){userWritingSearchTerm=!1},$scope.searchFieldFocus=function(){userWritingSearchTerm=!0},$scope.showMissingCharacterText=function(){return userWritingSearchTerm&&$scope.searchTerm.length<minimumSearchTermLength?!0:!1},$scope.search=function(){$scope.searchTerm.length<minimumSearchTermLength?$scope.missingChars=minimumSearchTermLength-$scope.searchTerm.length:($scope.missingChars=0,$state.go("todo.search",{searchTerm:$scope.searchTerm,pageNumber:1,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0}))}}]).controller("SearchResultController",["$scope","$state","paginationConfig","searchTerm","searchResults",function($scope,$state,paginationConfig,searchTerm,searchResults){console.log("Rendering search results page."),$scope.todos=searchResults.content,$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.pageChanged=function(newPageNumber){$state.go("todo.search",{searchTerm:searchTerm,pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("ViewTodoController",["$scope","$state","$modal","viewedTodo",function($scope,$state,$modal,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("todo.edit",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showDeleteDialog=function(){$modal.open({templateUrl:"frontend/partials/todo/delete-todo-modal.html",controller:"DeleteTodoController",resolve:{deletedTodo:function(){return $scope.todo}}})}}]),angular.module("app.todo.services",["ngResource"]).factory("Todos",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/todo/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(){return api.query()},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZHVsZS9jb21tb24vY29tbW9uLmNvbmZpZy5qcyIsIm1vZHVsZS9jb21tb24vY29tbW9uLmRpcmVjdGl2ZXMuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5zZXJ2aWNlcy5qcyIsIm1vZHVsZS9zZWFyY2gvc2VhcmNoLnNlcnZpY2VzLmpzIiwibW9kdWxlL3RvZG8vdG9kby5jb250cm9sbGVycy5qcyIsIm1vZHVsZS90b2RvL3RvZG8uc2VydmljZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFBLEtBQUEsUUFBQSxPQUFBLE9BQ0EsV0FDQSxZQUNBLGFBQ0EsYUFDQSx5QkFDQSxlQUNBLFlBQ0EsV0FDQSxnQkFDQSxnQkFDQSx3Q0FHQSxlQUdBLG9CQUFBLHdCQUFBLHNCQUdBLHNCQUdBLHVCQUFBLHFCQ3ZCQSxTQUFBLE9BQUEsd0JBQ0EsUUFBQSxxQkFBQSxvQkFDQSxTQUFBLG1CQUFBLG1CQUNBLG1CQUFBLFVBQUEsS0FHQSxrQkFBQSxXQUFBLE1BR0EsUUFBQSxxQkFBQSxTQUFBLG9CQUVBLG1CQUFBLHNCQUNBLE9BQUEsa0JBQ0EsT0FBQSxVQUdBLG1CQUFBLGtCQUFBLE1BQ0EsbUJBQUEsa0JBQ0EsbUJBQUEscUNBRUEsUUFBQSxnQkFBQSxTQUFBLGVBQ0EsY0FBQSxpQkFBQSxRQ3JCQSxRQUFBLE9BQUEsNEJBQ0EsVUFBQSxpQkFBQSxRQUFBLGlCQUFBLFdBQUEsU0FBQSxNQUFBLGVBQUEsVUFDQSxNQUFBLFVBQUEsTUFBQSxRQUFBLE9BQ0EsR0FBQSxjQUFBLE1BQUEsYUFFQSxPQUFBLElBQUEsY0FBQSxNQUFBLGlCQUFBLFFBQUEsU0FBQSxVQUNBLEdBQUEsVUFBQSxFQUFBLFVBQUEsS0FBQSxVQUFBLFVBQ0EsU0FBQSxLQUFBLFVBQ0EsU0FBQSxVQUFBLGFDUkEsUUFBQSxPQUFBLDBCQUNBLFFBQUEsdUJBQUEsYUFBQSxRQUFBLFNBQUEsV0FBQSxPQUdBLFFBQUEscUJBQUEsUUFBQSxNQUNBLFlBQUEsS0FDQSxNQUFBLGtCQUFBLFNBQ0EsU0FBQSxLQUNBLE1BQUEsZUFBQSxTQUNBLFNBQUEsS0FDQSxNQUFBLGVBQUEsU0FFQSxNQUFBLGdCQUFBLFNBVkEsR0FBQSxxQkF5QkEsT0FWQSxZQUFBLElBQUEsc0JBQUEsV0FDQSxLQUFBLGtCQUFBLE9BQUEsR0FBQSxDQUNBLEdBQUEsTUFBQSxrQkFBQSxPQUNBLE9BQ0Esb0JBQUEsS0FBQSxRQUFBLEtBQUEsVUFPQSxhQUFBLFNBQUEsUUFBQSxNQUNBLGtCQUFBLE1BQUEsUUFBQSxRQUFBLEtBQUEsTUFBQSxjQzdCQSxRQUFBLE9BQUEsdUJBQUEsZUFDQSxRQUFBLFVBQUEsWUFBQSxTQUFBLFdBQ0EsR0FBQSxLQUFBLFVBQUEsdUJBQ0EsT0FBQSxPQUFBLE1BQUEsU0FBQSxJQUdBLFFBQ0EsaUJBQUEsU0FBQSxXQUFBLFdBQUEsVUFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLFdBQUEsV0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLFlBQUEsY0NSQSxRQUFBLE9BQUEsMkJBQ0EsU0FBQSxvQkFDQSxTQUFBLElBRUEsUUFBQSxpQkFDQSxTQUFBLGdCQUNBLGVBQ0EsTUFBQSxRQUNBLElBQUEsSUFDQSxZQUFBLEVBQ0EsU0FBQSxlQUVBLE1BQUEsY0FDQSxJQUFBLEdBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsT0FBQSxRQUFBLFNBQUEsT0FDQSxNQUFBLE9BQUEsYUFJQSxNQUFBLFlBQ0EsSUFBQSxXQUNBLFdBQUEsb0JBQ0EsWUFBQSx5Q0FFQSxNQUFBLGFBQ0EsSUFBQSxvQkFDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxhQUFBLFFBQUEsZUFBQSxTQUFBLE1BQUEsY0FDQSxNQUFBLGNBQUEsT0FDQSxNQUFBLElBQUEsYUFBQSxRQUVBLFVBSUEsTUFBQSxlQUNBLElBQUEsMERBQ0EsV0FBQSx5QkFDQSxZQUFBLCtDQUNBLFNBQ0EsWUFBQSxlQUFBLFNBQUEsY0FDQSxNQUFBLGNBQUEsYUFFQSxlQUFBLFNBQUEsZUFBQSxTQUFBLE9BQUEsY0FDQSxNQUFBLGNBQUEsV0FDQSxPQUFBLGlCQUFBLGFBQUEsV0FBQSxhQUFBLFdBQUEsRUFBQSxhQUFBLFVBR0EsVUFJQSxNQUFBLGFBQ0EsSUFBQSxlQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLFlBQUEsUUFBQSxlQUFBLFNBQUEsTUFBQSxjQUNBLE1BQUEsY0FBQSxPQUNBLE1BQUEsSUFBQSxhQUFBLFFBRUEsYUFPQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxRQUNBLFNBQUEsT0FBQSxPQUFBLE9BQ0EsUUFBQSxJQUFBLG1DQUNBLE9BQUEsTUFBQSxNQUVBLE9BQUEsUUFBQSxXQUNBLE9BQUEsR0FBQSxnQkFHQSxXQUFBLHFCQUFBLFNBQUEsU0FBQSxRQUNBLFNBQUEsT0FBQSxPQUFBLE9BQ0EsUUFBQSxJQUFBLGtDQUNBLE9BQUEsUUFFQSxPQUFBLFNBQUEsV0FDQSxHQUFBLE9BQUEsU0FBQSxPQUFBLENBQ0EsR0FBQSxXQUFBLFNBQUEsT0FDQSxPQUFBLEdBQUEsYUFBQSxPQUFBLE1BQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsSUFHQSxPQUFBLEtBQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsd0JBQUEsU0FBQSxpQkFBQSxTQUFBLFFBQUEsY0FDQSxTQUFBLE9BQUEsZUFBQSxPQUFBLE1BQUEsYUFDQSxPQUFBLEtBQUEsWUFFQSxPQUFBLE9BQUEsV0FDQSxlQUFBLFFBQUEsV0FHQSxPQUFBLE9BQUEsV0FDQSxHQUFBLFdBQUEsV0FDQSxlQUFBLFFBQ0EsT0FBQSxHQUFBLGlCQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLE9BQUEsT0FBQSxPQUFBLEtBQUEsZUFHQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxjQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsWUFBQSxPQUNBLFFBQUEsSUFBQSxhQUNBLE9BQUEsS0FBQSxZQUVBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxTQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsUUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLE9BQUEsT0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSxvQkFBQSxTQUFBLFNBQUEsbUJBQ0EsU0FBQSxPQUFBLE9BQUEsa0JBRUEsR0FBQSx3QkFBQSxFQUNBLHdCQUFBLENBRUEsUUFBQSxhQUFBLHdCQUNBLE9BQUEsV0FBQSxHQUVBLE9BQUEsZ0JBQUEsV0FDQSx1QkFBQSxHQUdBLE9BQUEsaUJBQUEsV0FDQSx1QkFBQSxHQUdBLE9BQUEseUJBQUEsV0FDQSxNQUFBLHdCQUNBLE9BQUEsV0FBQSxPQUFBLHlCQUNBLEdBSUEsR0FHQSxPQUFBLE9BQUEsV0FDQSxPQUFBLFdBQUEsT0FBQSx3QkFDQSxPQUFBLGFBQUEsd0JBQUEsT0FBQSxXQUFBLFFBR0EsT0FBQSxhQUFBLEVBQ0EsT0FBQSxHQUFBLGVBQ0EsV0FBQSxPQUFBLFdBQUEsV0FBQSxFQUFBLFNBQUEsaUJBQUEsV0FDQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsU0FNQSxXQUFBLDBCQUFBLFNBQUEsU0FBQSxtQkFBQSxhQUFBLGdCQUNBLFNBQUEsT0FBQSxPQUFBLGlCQUFBLFdBQUEsZUFDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxNQUFBLGNBQUEsUUFFQSxPQUFBLFlBQ0EsWUFBQSxjQUFBLE9BQUEsRUFDQSxhQUFBLGlCQUFBLFNBQ0EsV0FBQSxjQUFBLGVBR0EsT0FBQSxZQUFBLFNBQUEsZUFDQSxPQUFBLEdBQUEsZUFDQSxXQUFBLFdBQUEsV0FBQSxjQUFBLFNBQUEsaUJBQUEsV0FDQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsUUFJQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxTQUFBLGFBQ0EsU0FBQSxPQUFBLE9BQUEsT0FBQSxZQUNBLFFBQUEsSUFBQSxtQ0FDQSxPQUFBLEtBQUEsV0FFQSxPQUFBLGFBQUEsV0FDQSxPQUFBLEdBQUEsYUFBQSxPQUFBLE9BQUEsS0FBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxLQUdBLE9BQUEsaUJBQUEsV0FDQSxPQUFBLE1BQ0EsWUFBQSxnREFDQSxXQUFBLHVCQUNBLFNBQ0EsWUFBQSxXQUNBLE1BQUEsUUFBQSxhQ3pNQSxRQUFBLE9BQUEscUJBQUEsZUFDQSxRQUFBLFNBQUEsWUFBQSxzQkFBQSxTQUFBLFVBQUEscUJBQ0EsR0FBQSxLQUFBLFVBQUEsaUJBQUEsR0FBQSxRQUNBLE9BQUEsT0FBQSxNQUFBLFVBQUEsU0FBQSxHQUNBLEtBQUEsT0FBQSxPQUNBLE1BQUEsT0FBQSxRQUNBLFFBQUEsT0FBQSxRQUdBLFFBQ0EsU0FBQSxTQUFBLEtBQUEsaUJBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUNBLG9CQUFBLGFBQUEsb0NBQUEsV0FDQSxxQkFHQSxNQUFBLFdBQ0EsTUFBQSxLQUFBLFNBRUEsSUFBQSxTQUFBLFFBQ0EsTUFBQSxLQUFBLEtBQUEsR0FBQSxTQUFBLFVBRUEsS0FBQSxTQUFBLEtBQUEsaUJBQ0EsSUFBQSxLQUFBLEtBQUEsU0FBQSxPQUNBLG9CQUFBLGFBQUEsaUNBQUEsV0FDQSxnQkFBQSxVQUdBLE9BQUEsU0FBQSxLQUFBLGlCQUNBLElBQUEsT0FBQSxLQUFBLFNBQUEsU0FDQSxvQkFBQSxhQUFBLG9DQUFBLFdBQ0EsZ0JBQUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIEFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICAgJ25nTG9jYWxlJyxcbiAgICAnbmdDb29raWVzJyxcbiAgICAnbmdSZXNvdXJjZScsXG4gICAgJ25nU2FuaXRpemUnLFxuICAgICdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJyxcbiAgICAndWkuYm9vdHN0cmFwJyxcbiAgICAndWkucm91dGVyJyxcbiAgICAndWkudXRpbHMnLFxuICAgICdhbmd1bGFyLWdyb3dsJyxcbiAgICAnYW5ndWxhck1vbWVudCcsXG4gICAgJ2FuZ3VsYXJVdGlscy5kaXJlY3RpdmVzLmRpclBhZ2luYXRpb24nLFxuXG4gICAgLy9QYXJ0aWFsc1xuICAgICdhcHAucGFydGlhbHMnLFxuXG4gICAgLy9Db21tb25cbiAgICAnYXBwLmNvbW1vbi5jb25maWcnLCAnYXBwLmNvbW1vbi5kaXJlY3RpdmVzJywgJ2FwcC5jb21tb24uc2VydmljZXMnLFxuXG4gICAgLy9TZWFyY2hcbiAgICAnYXBwLnNlYXJjaC5zZXJ2aWNlcycsXG5cbiAgICAvL1RvZG9cbiAgICAnYXBwLnRvZG8uY29udHJvbGxlcnMnLCAnYXBwLnRvZG8uc2VydmljZXMnXG5cbl0pO1xuXG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuY29tbW9uLmNvbmZpZycsIFtdKVxuICAgIC5jb25maWcoWyckdXJsUm91dGVyUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG4gICAgICAgICAgICAvLyBXaXRob3V0IHNlcnZlciBzaWRlIHN1cHBvcnQgaHRtbDUgbXVzdCBiZSBkaXNhYmxlZC5cbiAgICAgICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5jb25maWcoWyckdHJhbnNsYXRlUHJvdmlkZXInLCBmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIEluaXRpYWxpemUgYW5ndWxhci10cmFuc2xhdGVcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVN0YXRpY0ZpbGVzTG9hZGVyKHtcbiAgICAgICAgICAgIHByZWZpeDogJy9mcm9udGVuZC9pMThuLycsXG4gICAgICAgICAgICBzdWZmaXg6ICcuanNvbidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnByZWZlcnJlZExhbmd1YWdlKCdlbicpO1xuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXIudXNlTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VNaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyTG9nKCk7XG4gICAgfV0pXG4gICAgLmNvbmZpZyhbJ2dyb3dsUHJvdmlkZXInLCBmdW5jdGlvbiAoZ3Jvd2xQcm92aWRlcikge1xuICAgICAgICBncm93bFByb3ZpZGVyLmdsb2JhbFRpbWVUb0xpdmUoNTAwMCk7XG4gICAgfV0pOyIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC5jb21tb24uZGlyZWN0aXZlcycsIFtdKVxuICAgIC5kaXJlY3RpdmUoJ3N0YXRpY0luY2x1ZGUnLCBbJyRodHRwJywgJyR0ZW1wbGF0ZUNhY2hlJywgJyRjb21waWxlJywgZnVuY3Rpb24gKCRodHRwLCAkdGVtcGxhdGVDYWNoZSwgJGNvbXBpbGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgdmFyIHRlbXBsYXRlUGF0aCA9IGF0dHJzLnN0YXRpY0luY2x1ZGU7XG5cbiAgICAgICAgICAgICRodHRwLmdldCh0ZW1wbGF0ZVBhdGgsIHtjYWNoZTogJHRlbXBsYXRlQ2FjaGV9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50cyA9ICQoJzxkaXYvPicpLmh0bWwocmVzcG9uc2UpLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKGNvbnRlbnRzKTtcbiAgICAgICAgICAgICAgICAkY29tcGlsZShjb250ZW50cykoc2NvcGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfV0pOyIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC5jb21tb24uc2VydmljZXMnLCBbXSlcbiAgICAuc2VydmljZSgnTm90aWZpY2F0aW9uU2VydmljZScsIFsnJHJvb3RTY29wZScsICdncm93bCcsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBncm93bCkge1xuICAgICAgICB2YXIgZmxhc2hNZXNzYWdlUXVldWUgPSBbXTtcblxuICAgICAgICBmdW5jdGlvbiBkaXNwbGF5Tm90aWZpY2F0aW9uKG1lc3NhZ2UsIHR5cGUpIHtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICBncm93bC5hZGRTdWNjZXNzTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3dhcm4nKSB7XG4gICAgICAgICAgICAgICAgZ3Jvd2wuYWRkV2Fybk1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdpbmZvJykge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZEluZm9NZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBncm93bC5hZGRFcnJvck1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEaXNwbGF5IGFsbCBmbGFzaCBub3RpZmljYXRpb25zIGFmdGVyIHN0YXRlIGhhcyBjaGFuZ2VkXG4gICAgICAgICRyb290U2NvcGUuJG9uKFwiJHN0YXRlQ2hhbmdlU3VjY2Vzc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB3aGlsZSAoZmxhc2hNZXNzYWdlUXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gZmxhc2hNZXNzYWdlUXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Tm90aWZpY2F0aW9uKGl0ZW0ubWVzc2FnZSwgaXRlbS50eXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFB1YmxpYyBBUElcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdmbGFzaE1lc3NhZ2UnOiBmdW5jdGlvbiAobWVzc2FnZSwgdHlwZSkge1xuICAgICAgICAgICAgICAgIGZsYXNoTWVzc2FnZVF1ZXVlLnB1c2goe21lc3NhZ2U6IG1lc3NhZ2UsIHR5cGU6IHR5cGUgfHwgJ2luZm8nfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLnNlYXJjaC5zZXJ2aWNlcycsIFsnbmdSZXNvdXJjZSddKVxuICAgIC5mYWN0b3J5KCdTZWFyY2gnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgICAgICB2YXIgYXBpID0gJHJlc291cmNlKCcvYXBpL3RvZG8vc2VhcmNoJywge30sIHtcbiAgICAgICAgICAgICdxdWVyeSc6ICB7bWV0aG9kOidHRVQnLCBpc0FycmF5OmZhbHNlfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZmluZEJ5U2VhcmNoVGVybTogZnVuY3Rpb24oc2VhcmNoVGVybSwgcGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpLnF1ZXJ5KHtwYWdlOiBwYWdlTnVtYmVyLCBzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBzaXplOiBwYWdlU2l6ZSwgc29ydDogJ0lELERFU0MnfSkuJHByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pOyIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC50b2RvLmNvbnRyb2xsZXJzJywgW10pXG4gICAgLmNvbnN0YW50KCdwYWdpbmF0aW9uQ29uZmlnJywge1xuICAgICAgICBwYWdlU2l6ZTogNVxuICAgIH0pXG4gICAgLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kbycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nXG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmluZGV4Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVG9kb0xpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3RvZG8tbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9kb3M6IFsnVG9kb3MnLCBmdW5jdGlvbihUb2Rvcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUb2Rvcy5xdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmFkZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby9hZGQnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQWRkVG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vYWRkLXRvZG8uaHRtbCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kby5lZGl0Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvLzp0b2RvSWQvZWRpdCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0VG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vZWRpdC10b2RvLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkVG9kbzogWydUb2RvcycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihUb2RvcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy50b2RvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLmdldCgkc3RhdGVQYXJhbXMudG9kb0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uc2VhcmNoJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvL3NlYXJjaC86c2VhcmNoVGVybS9wYWdlLzpwYWdlTnVtYmVyL3NpemUvOnBhZ2VTaXplJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NlYXJjaFJlc3VsdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3NlYXJjaC9zZWFyY2gtcmVzdWx0cy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVGVybTogWyckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbigkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLnNlYXJjaFRlcm07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFJlc3VsdHM6IFsnU2VhcmNoJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFNlYXJjaCwgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5zZWFyY2hUZXJtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTZWFyY2guZmluZEJ5U2VhcmNoVGVybSgkc3RhdGVQYXJhbXMuc2VhcmNoVGVybSwgJHN0YXRlUGFyYW1zLnBhZ2VOdW1iZXIgLSAxLCAkc3RhdGVQYXJhbXMucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLnZpZXcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vOnRvZG9JZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdWaWV3VG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdmlldy10b2RvLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3ZWRUb2RvOiBbJ1RvZG9zJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFRvZG9zLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnRvZG9JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9kb3MuZ2V0KCRzdGF0ZVBhcmFtcy50b2RvSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIF0pXG5cbiAgICAuY29udHJvbGxlcignVG9kb0xpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3RvZG9zJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJHN0YXRlLCB0b2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyB0b2RvIGVudHJ5IGxpc3QgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHRvZG9zO1xuXG4gICAgICAgICAgICAkc2NvcGUuYWRkVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby5hZGQnKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdBZGRUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBUb2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBhZGQgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB7fTtcblxuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IGFkZGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBUb2Rvcy5zYXZlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdEZWxldGVUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRtb2RhbEluc3RhbmNlJywgJyRzdGF0ZScsICdUb2RvcycsICdkZWxldGVkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgVG9kb3MsIGRlbGV0ZWRUb2RvKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IGRlbGV0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8uaW5kZXgnLCB7fSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFRvZG9zLmRlbGV0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdFZGl0VG9kb0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAndXBkYXRlZFRvZG8nLCAnVG9kb3MnLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgdXBkYXRlZFRvZG8sIFRvZG9zKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh1cGRhdGVkVG9kbyk7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IHVwZGF0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZVRvZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnRvZG9Gb3JtLiR2YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnZpZXcnLCB7dG9kb0lkOiB1cGRhdGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgVG9kb3MudXBkYXRlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLFxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcpIHtcblxuICAgICAgICAgICAgdmFyIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoID0gMztcblxuICAgICAgICAgICAgJHNjb3BlLm1pc3NpbmdDaGFycyA9IG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoO1xuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaFRlcm0gPSBcIlwiO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXNlcldyaXRpbmdTZWFyY2hUZXJtID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRGb2N1cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd01pc3NpbmdDaGFyYWN0ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJXcml0aW5nU2VhcmNoVGVybSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaFRlcm0ubGVuZ3RoIDwgbWluaW11bVNlYXJjaFRlcm1MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGggPCBtaW5pbXVtU2VhcmNoVGVybUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gbWluaW11bVNlYXJjaFRlcm1MZW5ndGggLSAkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB7c2VhcmNoVGVybTogJHNjb3BlLnNlYXJjaFRlcm0sIHBhZ2VOdW1iZXI6IDEsIHBhZ2VTaXplOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hSZXN1bHRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLCAnc2VhcmNoVGVybScsICdzZWFyY2hSZXN1bHRzJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcsIHNlYXJjaFRlcm0sIHNlYXJjaFJlc3VsdHMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgc2VhcmNoIHJlc3VsdHMgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHNlYXJjaFJlc3VsdHMuY29udGVudDtcblxuICAgICAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IHNlYXJjaFJlc3VsdHMubnVtYmVyICsgMSxcbiAgICAgICAgICAgICAgICBpdGVtc1BlclBhZ2U6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemUsXG4gICAgICAgICAgICAgICAgdG90YWxJdGVtczogc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUucGFnZUNoYW5nZWQgPSBmdW5jdGlvbihuZXdQYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBwYWdlTnVtYmVyOiBuZXdQYWdlTnVtYmVyLCBwYWdlU2l6ZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZX0sXG4gICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ1ZpZXdUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICckbW9kYWwnLCAndmlld2VkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkbW9kYWwsIHZpZXdlZFRvZG8pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgdmlldyB0b2RvIGVudHJ5IHBhZ2UuJyk7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IHZpZXdlZFRvZG87XG5cbiAgICAgICAgICAgICRzY29wZS5zaG93RWRpdFBhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oXCJ0b2RvLmVkaXRcIiwge3RvZG9JZDogJHNjb3BlLnRvZG8uaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNob3dEZWxldGVEaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9kZWxldGUtdG9kby1tb2RhbC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0RlbGV0ZVRvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFRvZG86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnRvZG87XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAudG9kby5zZXJ2aWNlcycsIFsnbmdSZXNvdXJjZSddKVxuICAgIC5mYWN0b3J5KCdUb2RvcycsIFsnJHJlc291cmNlJywgJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UsIE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGFwaSA9ICRyZXNvdXJjZSgnL2FwaS90b2RvLzppZCcsIHtcImlkXCI6IFwiQGlkXCJ9LCB7XG4gICAgICAgICAgICBxdWVyeTogIHttZXRob2Q6ICdHRVQnLCBwYXJhbXM6IHt9LCBpc0FycmF5OiB0cnVlfSxcbiAgICAgICAgICAgIGdldDogICAge21ldGhvZDogJ0dFVCd9LFxuICAgICAgICAgICAgc2F2ZToge21ldGhvZDogJ1BPU1QnfSxcbiAgICAgICAgICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCd9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWxldGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkuZGVsZXRlKHRvZG8sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmRlbGV0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcXVlcnk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkucXVlcnkoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKHRvZG9JZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkuZ2V0KHtpZDogdG9kb0lkfSkuJHByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2F2ZTogZnVuY3Rpb24odG9kbywgc3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgYXBpLnNhdmUodG9kbywgZnVuY3Rpb24oYWRkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uU2VydmljZS5mbGFzaE1lc3NhZ2UoJ3RvZG8ubm90aWZpY2F0aW9ucy5hZGQuc3VjY2VzcycsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhhZGRlZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbih0b2RvLCBzdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBhcGkudXBkYXRlKHRvZG8sIGZ1bmN0aW9uKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uU2VydmljZS5mbGFzaE1lc3NhZ2UoJ3RvZG8ubm90aWZpY2F0aW9ucy51cGRhdGUuc3VjY2VzcycsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayh1cGRhdGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9